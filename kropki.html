<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychodem - TMT Clinical (No Hints)</title>
    <style>
        :root {
            --color-primary: #4f46e5;       
            --color-success: #10b981;       
            --color-default: #94a3b8;       
            --color-error: #ef4444;         
            --bg-body: #f1f5f9;             
            --bg-card: #ffffff;             
            --text-main: #1e293b;           
            --text-muted: #64748b;          
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.patient-mode {
            background-color: #ffffff;
            justify-content: center;
            overflow: hidden;
            padding: 0;
        }

        body.patient-mode header, body.patient-mode #admin-panel, body.patient-mode #results-card {
            display: none !important;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: 25px;
            text-align: center;
            width: 100%;
            max-width: 800px;
        }

        .logo-wrapper img { max-height: 60px; margin-bottom: 10px; }
        h1 { margin: 10px 0; font-size: 1.5rem; }
        
        .controls { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        select, button { padding: 12px 20px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 1rem; cursor: pointer; }
        
        button.primary-btn {
            background-color: var(--color-primary);
            color: white;
            border: none;
            font-weight: 600;
        }

        canvas {
            background-color: white;
            border-radius: var(--radius);
            cursor: crosshair;
            touch-action: none;
            box-shadow: var(--shadow-md);
            margin-top: 20px;
        }

        #results-card { display: none; margin-top: 20px; text-align: left; }
        .norm-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .norm-table th, .norm-table td { padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: left; font-size: 0.9rem; }
        .highlight-row { background-color: #ecfdf5; font-weight: bold; }
        .highlight-row-bad { background-color: #fef2f2; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="logo-wrapper"><img src="logo.png" alt="Logo"></div>
        <h1>Test ≈ÅƒÖczenia Punkt√≥w (TMT)</h1>
    </header>

    <div id="admin-panel" class="card">
        <div class="controls">
            <select id="levelSelect">
                <option value="A">Wersja A (Liczby 1-25)</option>
                <option value="B">Wersja B (1-A-2-B...)</option>
            </select>
            <button class="primary-btn" onclick="startTest()">Rozpocznij Test</button>
        </div>
        <p style="color: var(--text-muted); font-size: 0.85rem;">Brak podpowiedzi wizualnych w trakcie testu.</p>
    </div>

    <div id="results-card" class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <strong style="font-size:1.2rem;">Wynik ko≈Ñcowy</strong>
            <span id="final-time-display" style="color: var(--color-primary); font-size: 1.5rem; font-weight:bold;">00:00</span>
        </div>
        <div id="interpretation-text"></div>
        <table class="norm-table">
            <thead><tr><th>Interpretacja</th><th>Wersja A</th><th>Wersja B</th></tr></thead>
            <tbody>
                <tr id="row-norm"><td>üü¢ Norma</td><td>&lt; 40s</td><td>&lt; 60s</td></tr>
                <tr id="row-low"><td>üü† Wynik obni≈ºony</td><td>41-90s</td><td>61-180s</td></tr>
                <tr id="row-clinical"><td>üî¥ Wynik kliniczny</td><td>&gt; 90s</td><td>&gt; 180s</td></tr>
            </tbody>
        </table>
        <p style="font-size:0.8rem; margin-top:10px;">B≈Çƒôdy: <span id="error-display-count">0</span></p>
        <button style="margin-top:15px; width:100%;" onclick="location.reload()">Nowy test</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const LEVELS = {
            A: { labels: Array.from({ length: 25 }, (_, i) => (i + 1).toString()) },
            B: { labels: ['1', 'A', '2', 'B', '3', 'C', '4', 'D', '5', 'E', '6', 'F', '7', 'G', '8', 'H', '9', 'I', '10', 'J', '11', 'K', '12', 'L', '13'] }
        };

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let currentLevel, points = [], connections = [], currentPointIndex = 0;
        let startTime, endTime, errorCount = 0, isRunning = false;

        function startTest() {
            const type = document.getElementById('levelSelect').value;
            currentLevel = LEVELS[type];
            currentLevel.type = type;
            points = generatePoints(currentLevel.labels);
            connections = [];
            currentPointIndex = 0;
            errorCount = 0;
            startTime = null;
            document.body.classList.add('patient-mode');
            isRunning = true;
            draw();
        }

        function generatePoints(labels) {
            const pts = [];
            for (let label of labels) {
                let p, valid, attempts = 0;
                do {
                    valid = true;
                    p = { x: Math.random() * 720 + 40, y: Math.random() * 520 + 40, label: label };
                    for (let e of pts) if (Math.hypot(p.x - e.x, p.y - e.y) < 60) valid = false;
                    attempts++;
                } while (!valid && attempts < 1000);
                pts.push(p);
            }
            return pts;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Linie po≈ÇƒÖcze≈Ñ
            ctx.strokeStyle = "#4f46e5";
            ctx.lineWidth = 3;
            ctx.beginPath();
            connections.forEach(c => { ctx.moveTo(c.start.x, c.start.y); ctx.lineTo(c.end.x, c.end.y); });
            ctx.stroke();

            // Punkty
            points.forEach((p, idx) => {
                const done = idx < currentPointIndex;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 18, 0, Math.PI * 2);
                ctx.fillStyle = done ? "#10b981" : "#e2e8f0";
                ctx.fill();
                
                // BRAK OBRAMOWANIA DLA NASTƒòPNEGO PUNKTU (USUNIƒòTO STROKE)
                
                ctx.fillStyle = done ? "white" : "#1e293b";
                ctx.font = "bold 16px Arial";
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(p.label, p.x, p.y);
            });
        }

        canvas.addEventListener('mousedown', (e) => {
            if (!isRunning) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            const target = points[currentPointIndex];

            if (Math.hypot(x - target.x, y - target.y) < 25) {
                if (currentPointIndex === 0) startTime = Date.now();
                else connections.push({ start: points[currentPointIndex - 1], end: target });
                
                currentPointIndex++;
                draw();
                if (currentPointIndex === points.length) {
                    isRunning = false;
                    endTime = Date.now();
                    finish();
                }
            } else if (startTime) {
                // Sprawd≈∫ czy klikniƒôto w inny punkt (b≈ÇƒÖd)
                points.forEach((p, i) => {
                    if (i >= currentPointIndex && Math.hypot(x - p.x, y - p.y) < 25) errorCount++;
                });
            }
        });

        function finish() {
            document.body.classList.remove('patient-mode');
            const total = (endTime - startTime) / 1000;
            const mins = Math.floor(total / 60);
            const secs = Math.floor(total % 60);
            document.getElementById('final-time-display').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('error-display-count').textContent = errorCount;
            
            let status = 'norm';
            if (currentLevel.type === 'A') {
                if (total > 90) status = 'clinical'; else if (total > 40) status = 'low';
            } else {
                if (total > 180) status = 'clinical'; else if (total > 60) status = 'low';
            }

            document.querySelectorAll('.norm-table tr').forEach(r => r.className = '');
            const rowId = status === 'norm' ? 'row-norm' : (status === 'low' ? 'row-low' : 'row-clinical');
            document.getElementById(rowId).className = status === 'norm' ? 'highlight-row' : 'highlight-row-bad';
            
            document.getElementById('results-card').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
        }
    </script>
</body>
</html>
