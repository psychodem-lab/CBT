<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyzwania UmysÅ‚u - Trening Psychologiczny</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee; --bg: #f8f9fa; --text: #212529;
            --card: #ffffff; --success: #4cc9f0; --danger: #f72585;
            --warning: #ff9f1c; --radius: 16px;
        }
        body.dark-mode {
            --bg: #121212; --text: #e0e0e0; --card: #1e1e1e; --primary: #4cc9f0;
        }
        * { box-sizing: border-box; color: var(--text); }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--bg); margin: 0; transition: 0.3s;
        }
        #app { max-width: 700px; margin: 0 auto; padding: 20px; }
        .card { background: var(--card); border-radius: var(--radius); padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .progress-bar { height: 10px; background: #333; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); transition: 0.5s; }

        .btn-choice { 
            width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #444; 
            border-radius: 10px; background: var(--card); cursor: pointer; text-align: left;
            transition: 0.2s; font-size: 15px; display: block;
        }
        .btn-choice:hover { background: var(--primary); color: white; }
        
        .feedback { padding: 15px; border-radius: 10px; margin: 15px 0; font-weight: bold; display: none; }
        .correct { background: #1b4332 !important; color: #74c69d !important; border: 1px solid #2d6a4f; }
        .wrong { background: #431212 !important; color: #ff8787 !important; border: 1px solid #641212; }

        textarea { width: 100%; height: 120px; background: var(--card); color: var(--text); border-radius: 8px; padding: 10px; border: 1px solid #444; }
        .hidden { display: none; }
        
        /* Styl mini gry */
        .mini-game-box { text-align: center; padding: 20px; border: 2px dashed var(--primary); border-radius: 15px; margin-top: 20px; }
        .category-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }

        @media print {
            .no-print { display: none; }
            body { background: white; color: black; }
            .card { box-shadow: none; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>

<div id="app">
    <div class="header no-print">
        <div style="color: var(--text)">â­ <span id="xp">0</span> XP | âš¡ <span id="energy">100</span>%</div>
        <button onclick="document.body.classList.toggle('dark-mode')" style="background: var(--card); border: 1px solid #444; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ğŸŒ“ Tryb</button>
    </div>
    <div class="progress-bar no-print"><div id="p-fill" class="progress-fill" style="width: 100%"></div></div>

    <div id="m-menu" class="card no-print">
        <h2>Twoje Wyzwania</h2>
        <div id="hero-list"></div>
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #444;">
        <button class="btn-choice" style="text-align: center; background: var(--warning); color: black;" onclick="startMiniGame()">ğŸ§ª Laboratorium: Fakty vs MyÅ›li</button>
        <button class="btn-choice" style="text-align: center; background: var(--success); color: black;" onclick="printSummary()">ğŸ–¨ï¸ Generuj Raport Treningowy</button>
    </div>

    <div id="m-game" class="card hidden no-print">
        <h3 id="g-title"></h3>
        <p id="g-text" style="font-size: 1.1em;"></p>
        <div id="g-choices"></div>
        <div id="g-feedback" class="feedback"></div>
        <button id="g-next" class="btn-choice hidden" style="background: var(--primary); color: white; text-align: center;" onclick="goReflection()">Dalej</button>
    </div>

    <div id="m-mini-game" class="card hidden no-print">
        <h3>ğŸ§ª Laboratorium Poznawcze</h3>
        <p>Zaklasyfikuj poniÅ¼sze stwierdzenie do odpowiedniej kategorii:</p>
        <div class="mini-game-box">
            <h2 id="mg-statement">ÅadujÄ™...</h2>
        </div>
        <div class="category-grid">
            <button class="btn-choice" style="text-align:center" onclick="checkMG('Fakt')">Fakt</button>
            <button class="btn-choice" style="text-align:center" onclick="checkMG('MyÅ›l')">MyÅ›l</button>
            <button class="btn-choice" style="text-align:center" onclick="checkMG('Emocja')">Emocja</button>
            <button class="btn-choice" style="text-align:center" onclick="checkMG('Zachowanie')">Zachowanie</button>
        </div>
        <div id="mg-feedback" class="feedback"></div>
        <button id="mg-back" class="btn-choice hidden" style="background: var(--primary); color: white; text-align: center;" onclick="resetToMenu()">WrÃ³Ä‡ do menu</button>
    </div>

    <div id="m-reflect" class="card hidden no-print">
        <h3>Twoja Refleksja</h3>
        <p id="r-prompt"></p>
        <textarea id="r-input" placeholder="Wpisz swoje przemyÅ›lenia..."></textarea>
        <button class="btn-choice" style="background: var(--success); color: black; text-align: center;" onclick="saveAndExit()">Zapisz i wrÃ³Ä‡</button>
    </div>

    <div id="m-summary" class="hidden">
        <h1 style="text-align: center;">Raport Treningu UmiejÄ™tnoÅ›ci Psychologicznych</h1>
        <div id="s-content"></div>
        <button class="btn-choice no-print" onclick="window.location.reload()">WrÃ³Ä‡ do gry</button>
    </div>
</div>

<script>
    const scenarios = [
        { id: 0, icon: 'ğŸ˜¤', title: 'Marek: WyÅ›miewanie', text: 'Koledzy drwiÄ… z Twojego hobby (szachy). Co mÃ³wisz?', rQ: 'Jakie emocje czuÅ‚eÅ›, wybierajÄ…c tÄ™ odpowiedÅº?', 
          choices: [
            { t: 'â€Sami jesteÅ›cie nudni, spadajcie!â€', type: 'agresja', f: 'Agresja wywoÅ‚uje opÃ³r.', xp: 5, en: -20 },
            { t: '(Milczysz i odchodzisz)', type: 'ulegÅ‚oÅ›Ä‡', f: 'UlegÅ‚oÅ›Ä‡ kumuluje frustracjÄ™.', xp: 2, en: -15 },
            { t: 'â€LubiÄ™ szachy. Przykro mi, Å¼e tak to oceniacie. ProszÄ™ przestaÅ„cie.â€', type: 'asertywnoÅ›Ä‡', f: 'Wzorowa asertywnoÅ›Ä‡ (Komunikat JA).', xp: 25, en: 0 },
            { t: 'â€Przynajmniej nie oblewam matmy jak wy.â€', type: 'pas-agresja', f: 'Pasywna agresja niszczy relacje.', xp: 10, en: -10 },
            { t: 'â€Dobra, macie racjÄ™, to gÅ‚upie.â€', type: 'unikanie', f: 'Zdrada wÅ‚asnych wartoÅ›ci obniÅ¼a samoocenÄ™.', xp: 0, en: -25 }
          ]},
        { id: 1, icon: 'ğŸ˜°', title: 'Ania: LÄ™k SpoÅ‚eczny', text: 'Stoisz przed grupÄ…. Czujesz, Å¼e zaraz zapomnisz jÄ™zyka.', rQ: 'Czy w realnym Å¼yciu teÅ¼ stosujesz unikanie czy konfrontacjÄ™?',
          choices: [
            { t: 'Uciekam z pokoju.', type: 'ulegÅ‚oÅ›Ä‡', f: 'Ucieczka karmi lÄ™k.', xp: 0, en: -30 },
            { t: 'MÃ³wiÄ™: â€StresujÄ™ siÄ™, dajcie mi chwilÄ™â€.', type: 'asertywnoÅ›Ä‡', f: 'Autodemaskacja lÄ™ku obniÅ¼a napiÄ™cie.', xp: 25, en: -5 },
            { t: 'Zaczynam krzyczeÄ‡ na osobÄ™ w pierwszym rzÄ™dzie.', type: 'agresja', f: 'Przemieszczenie zÅ‚oÅ›ci.', xp: 5, en: -40 },
            { t: 'StosujÄ™ oddech 4-7-8 i zaczynam mÃ³wiÄ‡.', type: 'asertywnoÅ›Ä‡', f: 'Regulacja fizjologiczna (nerw bÅ‚Ä™dny).', xp: 30, en: 0 },
            { t: 'WyobraÅ¼am sobie, Å¼e wszyscy sÄ… w Å›miesznych strojach.', type: 'unikanie', f: 'Dystansowanie poznawcze â€“ pomocne doraÅºnie.', xp: 15, en: -5 }
          ]},
        { id: 2, icon: 'ğŸ’¬', title: 'Kasia: Granice', text: 'Przyjaciel chce poÅ¼yczyÄ‡ pieniÄ…dze po raz piÄ…ty.', rQ: 'Co jest dla Ciebie trudniejsze: odmowa czy poÅ¼yczenie wbrew sobie?',
          choices: [
            { t: 'â€Nie mam, idÅº do banku.â€', type: 'agresja', f: 'Szorstka odmowa.', xp: 10, en: -5 },
            { t: 'â€Jasne, nie ma problemu (choÄ‡ sam nie mam).â€', type: 'ulegÅ‚oÅ›Ä‡', f: 'Brak granic niszczy CiÄ™ od Å›rodka.', xp: 2, en: -30 },
            { t: 'â€ChÄ™tnie bym pomÃ³gÅ‚, ale umÃ³wiliÅ›my siÄ™ na zwrot poprzednich. Nie poÅ¼yczÄ™.â€', type: 'asertywnoÅ›Ä‡', f: 'Konsekwencja i dbanie o zasady.', xp: 25, en: 0 },
            { t: 'â€Znowu to samo? JesteÅ› beznadziejny.â€', type: 'pas-agresja', f: 'Atak personalny zamiast odmowy.', xp: 5, en: -15 },
            { t: 'â€Zobaczymy... pogadamy pÃ³Åºniej.â€', type: 'unikanie', f: 'Zwlekanie zwiÄ™ksza stres.', xp: 5, en: -10 }
          ]}
    ];

    // DopeÅ‚nienie do 10 scenariuszy
    for(let i=3; i<10; i++) {
        scenarios.push({
            id: i, icon: 'ğŸ§ ', title: `Wyzwanie ${i+1}`, text: 'Sytuacja wymagajÄ…ca wyboru postawy psychologicznej.', rQ: 'Co byÅ‚o Twoim priorytetem w tej decyzji?',
            choices: [
                { t: 'Ostra riposta', type: 'agresja', f: 'Zbyt impulsywnie.', xp: 5, en: -20 },
                { t: 'Zgoda dla Å›wiÄ™tego spokoju', type: 'ulegÅ‚oÅ›Ä‡', f: 'Twoje potrzeby sÄ… waÅ¼ne.', xp: 5, en: -30 },
                { t: 'Jasne okreÅ›lenie swojego zdania', type: 'asertywnoÅ›Ä‡', f: 'Idealna rÃ³wnowaga.', xp: 25, en: 0 },
                { t: 'ZÅ‚oÅ›liwa uwaga pod nosem', type: 'pas-agresja', f: 'To psuje atmosferÄ™.', xp: 10, en: -15 },
                { t: 'Zmiana tematu / wyjÅ›cie', type: 'unikanie', f: 'Problem pozostanie.', xp: 5, en: -10 }
            ]
        });
    }

    // Mini Gra - Dane
    const miniGameData = [
        { s: "CzujÄ™ ucisk w klatce piersiowej.", c: "Fakt" },
        { s: "Na pewno mnie nie lubiÄ….", c: "MyÅ›l" },
        { s: "CzujÄ™ smutek.", c: "Emocja" },
        { s: "WyszedÅ‚em z pokoju bez sÅ‚owa.", c: "Zachowanie" },
        { s: "Moje tÄ™tno wynosi 100 uderzeÅ„ na minutÄ™.", c: "Fakt" },
        { s: "Jestem beznadziejny.", c: "MyÅ›l" },
        { s: "CzujÄ™ lÄ™k.", c: "Emocja" },
        { s: "ZacisnÄ…Å‚em piÄ™Å›ci.", c: "Zachowanie" }
    ];

    let state = { xp: 0, energy: 100, current: null, results: [], mgIndex: 0 };

    function init() {
        const list = document.getElementById('hero-list');
        list.innerHTML = '';
        scenarios.forEach(s => {
            list.innerHTML += `<button class="btn-choice" onclick="start(${s.id})">${s.icon} ${s.title}</button>`;
        });
    }

    function start(id) {
        state.current = scenarios[id];
        document.getElementById('m-menu').classList.add('hidden');
        document.getElementById('m-game').classList.remove('hidden');
        document.getElementById('g-title').innerText = state.current.title;
        document.getElementById('g-text').innerText = state.current.text;
        
        const cDiv = document.getElementById('g-choices');
        cDiv.innerHTML = '';
        state.current.choices.forEach((c, idx) => {
            cDiv.innerHTML += `<button class="btn-choice" onclick="select(${idx})">${c.t}</button>`;
        });
    }

    function select(idx) {
        const c = state.current.choices[idx];
        state.xp += c.xp;
        state.energy = Math.max(0, state.energy + c.en);
        document.getElementById('xp').innerText = state.xp;
        document.getElementById('energy').innerText = state.energy;
        document.getElementById('p-fill').style.width = state.energy + '%';

        const fb = document.getElementById('g-feedback');
        fb.innerText = c.f;
        fb.className = `feedback show ${c.type === 'asertywnoÅ›Ä‡' ? 'correct' : 'wrong'}`;
        fb.style.display = 'block';
        document.getElementById('g-next').classList.remove('hidden');
    }

    function goReflection() {
        document.getElementById('m-game').classList.add('hidden');
        document.getElementById('m-reflect').classList.remove('hidden');
        document.getElementById('r-prompt').innerText = state.current.rQ;
    }

    function saveAndExit() {
        const reflection = document.getElementById('r-input').value;
        state.results.push({ title: state.current.title, reflection: reflection });
        resetToMenu();
    }

    function resetToMenu() {
        document.getElementById('r-input').value = '';
        document.getElementById('g-next').classList.add('hidden');
        document.getElementById('g-feedback').style.display = 'none';
        document.getElementById('m-reflect').classList.add('hidden');
        document.getElementById('m-game').classList.add('hidden');
        document.getElementById('m-mini-game').classList.add('hidden');
        document.getElementById('m-menu').classList.remove('hidden');
    }

    // ObsÅ‚uga Mini Gry
    function startMiniGame() {
        state.mgIndex = 0;
        document.getElementById('m-menu').classList.add('hidden');
        document.getElementById('m-mini-game').classList.remove('hidden');
        document.getElementById('mg-back').classList.add('hidden');
        renderMG();
    }

    function renderMG() {
        if(state.mgIndex >= miniGameData.length) {
            document.getElementById('mg-statement').innerText = "Brawo! UkoÅ„czono laboratorium.";
            document.getElementById('mg-back').classList.remove('hidden');
            return;
        }
        document.getElementById('mg-statement').innerText = miniGameData[state.mgIndex].s;
        document.getElementById('mg-feedback').style.display = 'none';
    }

    function checkMG(category) {
        const correct = miniGameData[state.mgIndex].c;
        const fb = document.getElementById('mg-feedback');
        fb.style.display = 'block';
        
        if(category === correct) {
            fb.innerText = "Poprawnie! +10 XP";
            fb.className = "feedback correct";
            state.xp += 10;
        } else {
            fb.innerText = `To bÅ‚Ä…d. Poprawna kategoria to: ${correct}`;
            fb.className = "feedback wrong";
        }
        document.getElementById('xp').innerText = state.xp;
        
        setTimeout(() => {
            state.mgIndex++;
            renderMG();
        }, 1500);
    }

    function printSummary() {
        document.getElementById('m-menu').classList.add('hidden');
        document.getElementById('m-summary').classList.remove('hidden');
        const content = document.getElementById('s-content');
        content.innerHTML = state.results.map(r => `
            <div class="card">
                <h3>${r.title}</h3>
                <p><strong>Refleksja:</strong> ${r.reflection || 'Brak'}</p>
            </div>
        `).join('') || '<p>Najpierw ukoÅ„cz zadania!</p>';
        window.print();
    }

    init();
</script>
</body>
</html>
