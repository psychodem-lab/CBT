<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktywna Tarcza Wartości - ACT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg: #f8fafc;
            --primary: #1e293b;
            --accent: #ef4444;
            --secondary: #3b82f6;
            --text: #334155;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        h1 { color: var(--primary); text-align: center; margin-bottom: 10px; }
        
        .instructions {
            background: #f1f5f9;
            padding: 20px;
            border-left: 4px solid var(--secondary);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        canvas {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: crosshair;
            background: #fff;
            max-width: 100%;
        }

        .action-plan {
            margin-top: 30px;
            padding: 20px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            display: none; /* Pokazywane po oddaniu strzału */
        }

        .action-plan h3 { color: var(--accent); margin-top: 0; }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            margin-top: 10px;
            font-family: inherit;
            resize: vertical;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
        }

        button {
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-main { background: var(--secondary); color: white; }
        .btn-outline { background: #e2e8f0; color: var(--primary); }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.8rem;
            color: #94a3b8;
        }
    </style>
</head>
<body>

<div class="card">
    <h1>Technika "The Bull's Eye"</h1>
    
    <div class="instructions">
        <strong>Instrukcja obsługi:</strong>
        <ol>
            <li>Tarcza reprezentuje Twoje wartości w 4 sferach życia. Środek ("dziesiątka") to życie w 100% zgodne z Twoimi wartościami.</li>
            <li>Kliknij w każdym z 4 pól, aby postawić kropkę tam, gdzie Twoim zdaniem obecnie się znajdujesz.</li>
            <li>Im dalej od środka postawisz znak, tym większy rozdźwięk czujesz między swoimi marzeniami a rzeczywistością.</li>
        </ol>
    </div>

    <div class="canvas-container">
        <canvas id="bullsEye" width="600" height="600"></canvas>
    </div>

    <div id="actionContainer" class="action-plan">
        <h3 id="worstAreaTitle">Plan naprawczy</h3>
        <p>To jest obszar, który obecnie najbardziej odbiega od Twoich wartości. Jaki jeden, mały <strong>krok behawioralny</strong> możesz wykonać w tym tygodniu, aby zbliżyć się do środka tarczy?</p>
        <textarea id="behavioralStep" placeholder="Np. 'Zadzwonię do mamy w czwartek o 18:00' lub 'Pójdę na 15-minutowy spacer po pracy'"></textarea>
    </div>

    <div class="controls">
        <button class="btn-outline" onclick="reset()">Wyczyść tarczę</button>
        <button class="btn-main" onclick="downloadPDF()">Pobierz Raport PDF</button>
    </div>

    <footer>
        Opracowano na podstawie: Lundgren, T. et al. (2012). The Bull's-Eye Values Survey.
    </footer>
</div>

<script>
    const { jsPDF } = window.jspdf;
    const canvas = document.getElementById('bullsEye');
    const ctx = canvas.getContext('2d');
    const actionContainer = document.getElementById('actionContainer');
    const worstAreaTitle = document.getElementById('worstAreaTitle');
    
    const size = 600;
    const center = size / 2;
    const maxRadius = 260;
    
    let shots = {
        "Praca i Edukacja": null,
        "Relacje": null,
        "Czas Wolny": null,
        "Zdrowie i Rozwój": null
    };

    function draw() {
        ctx.clearRect(0, 0, size, size);
        
        // Tło tarczy
        ctx.beginPath();
        ctx.arc(center, center, maxRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#ffffff";
        ctx.fill();
        ctx.strokeStyle = "#cbd5e1";
        ctx.stroke();

        // Okręgi pomocnicze
        for(let i=1; i<=5; i++) {
            ctx.beginPath();
            ctx.arc(center, center, (maxRadius/5)*i, 0, Math.PI*2);
            ctx.stroke();
        }

        // Linie podziału
        ctx.beginPath();
        ctx.moveTo(center - maxRadius, center); ctx.lineTo(center + maxRadius, center);
        ctx.moveTo(center, center - maxRadius); ctx.lineTo(center, center + maxRadius);
        ctx.strokeStyle = "#1e293b";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Czytelne Etykiety Sfer
        ctx.font = "bold 18px Inter, sans-serif";
        ctx.fillStyle = "#1e293b";
        ctx.textAlign = "center";
        
        ctx.fillText("PRACA I EDUKACJA", center + 130, center - 130);
        ctx.fillText("RELACJE", center - 130, center - 130);
        ctx.fillText("CZAS WOLNY", center - 130, center + 145);
        ctx.fillText("ZDROWIE I ROZWÓJ", center + 130, center + 145);

        // Rysowanie strzałów
        Object.values(shots).forEach(s => {
            if(s) {
                ctx.beginPath();
                ctx.arc(s.x, s.y, 10, 0, Math.PI*2);
                ctx.fillStyle = "#ef4444";
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 3;
                ctx.stroke();
            }
        });
    }

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (size / rect.width);
        const y = (e.clientY - rect.top) * (size / rect.height);
        
        const dist = Math.sqrt(Math.pow(x-center, 2) + Math.pow(y-center, 2));
        
        if(dist <= maxRadius) {
            let area = "";
            if(x > center && y < center) area = "Praca i Edukacja";
            else if(x < center && y < center) area = "Relacje";
            else if(x < center && y > center) area = "Czas Wolny";
            else area = "Zdrowie i Rozwój";

            shots[area] = {x, y, dist};
            draw();
            updateActionPlan();
        }
    });

    function updateActionPlan() {
        let maxDist = -1;
        let worstArea = "";

        for (const [name, data] of Object.entries(shots)) {
            if(data && data.dist > maxDist) {
                maxDist = data.dist;
                worstArea = name;
            }
        }

        if(worstArea) {
            actionContainer.style.display = "block";
            worstAreaTitle.innerText = `Obszar wymagający uwagi: ${worstArea}`;
        }
    }

    function reset() {
        shots = { "Praca i Edukacja": null, "Relacje": null, "Czas Wolny": null, "Zdrowie i Rozwój": null };
        actionContainer.style.display = "none";
        document.getElementById('behavioralStep').value = "";
        draw();
    }

    function downloadPDF() {
        const doc = new jsPDF();
        doc.setFontSize(20);
        doc.text("Raport Bull's Eye - Analiza Wartosci", 20, 20);
        
        const img = canvas.toDataURL('image/png');
        doc.addImage(img, 'PNG', 40, 40, 130, 130);
        
        doc.setFontSize(14);
        doc.text("Twoje wyniki (0-100% spójności):", 20, 180);
        
        let y = 190;
        doc.setFontSize(11);
        for (const [name, data] of Object.entries(shots)) {
            const score = data ? Math.round(100 - (data.dist/maxRadius*100)) : "Nie oceniono";
            doc.text(`${name}: ${score}%`, 20, y);
            y += 8;
        }

        const plan = document.getElementById('behavioralStep').value;
        if(plan) {
            doc.setFontSize(14);
            doc.text("Zaplanowany krok behawioralny:", 20, y + 10);
            doc.setFontSize(11);
            doc.text(doc.splitTextToSize(plan, 170), 20, y + 20);
        }

        doc.save("moje_wartosci.pdf");
    }

    draw();
</script>

</body>
</html>
